#!/bin/sh

. /home/engines/functions/checks.sh\r\n\r\n\r\n  if test $type_path = \"domains\"\r\n    then\t\r\n     if ! test ${domain_name} = engines.internal\r\n      then\r\n  \t   rm /home/bind/engines/domains/${domain_name}\r\n  \t   rm  /home/bind/domain_list/*/${domain_name}\r\n  \t   rm /home/bind/engines/zones/named.conf.${domain_name}\r\n  \t   cat /home/bind/engines/domains/* > /home/bind/engines/domains.hosted\r\n  \t   kill -HUP `cat /home/engines/run/named.pid`\r\n       echo Success\r\n  \t   exit\r\n  \tfi\r\n  fi\r\n\r\n\r\nif test -z ${hostname}\r\n then\r\n  echo Error:Missing hostname ${hostname}\r\n  exit -1\r\nfi\r\n\r\n    \r\n#FIXME make engines.internal settable\r\ndns_cmd_file=`mktemp`\r\nfqdn_str=${hostname}.engines.internal\r\necho server 127.0.0.1 > $dns_cmd_file\r\necho update delete $fqdn_str >> $dns_cmd_file\r\necho send >> $dns_cmd_file\r\n\t\r\nnsupdate -k /etc/bind/keys/ddns.private $dns_cmd_file\r\nr=$?\r\ncp  $dns_cmd_file /tmp/rm_$fqdn_str\r\n\t\r\nif test $r -eq 0\r\n then\r\n  echo Success\r\n else\r\n  file=`cat $dns_cmd_file`\r\n  echo Error:With nsupdate $file\r\nfi\r\n\t\r\n\r\nip_reversed=`echo $ip |awk  ' BEGIN {  FS=\".\"} {print $4 \".\" $3 \".\" $2 \".\" $1}'`\r\necho server 127.0.0.1 > $dns_cmd_file\r\necho update delete ${ip_reversed}.in-addr.arpa. >> $dns_cmd_file\r\necho send >> $dns_cmd_file\r\nnsupdate -k /etc/bind/keys/ddns.private $dns_cmd_file\r\ninr=$?\r\ncp $dns_cmd_file /tmp/rm_inapra_$fqdn_str\r\n\r\nif test $inr -eq 0\r\n then\r\n   rm $dns_cmd_file\r\n   echo Success\r\n else\r\n   file=`cat $dns_cmd_file`\r\n   echo Error:With nsupdate $file\r\nfi\r\n\t\r\nreturn=`expr $r + $inr`\r\nexit $return
